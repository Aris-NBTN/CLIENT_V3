import{Y as de,c as ce,d as y,r as i,j as a,Z as F,$ as me,a0 as he,V as c,a1 as ue,a2 as q,a3 as pe,a4 as xe,a5 as fe,i as E,t as ye,w as ge,a6 as be}from"./index-CPBF7azd.js";import{b7 as ve}from"./Layout-6kY_fdgg.js";import{E as P}from"./Table-CbyYs7d6.js";import{F as p,a as w,b as Ce,c as je}from"./Filter-BrxRTPhw.js";import{d as ke,e as Fe,f as we}from"./Format-CjK6yOC7.js";import{e as Se}from"./export-CmwYOzSC.js";import{b as Ie}from"./index-8AvD9LWa.js";import{l as Ae}from"./lodash-A2PjbQZS.js";import{F as r}from"./index-CZw2qTD0.js";import{T as S}from"./index-BHMnDpbp.js";import{B as x,M as I}from"./index-DyMsIEIg.js";import{T as De}from"./index-B7vBM7Fg.js";import{T as Te}from"./index-n3XPPBpk.js";import{I as O}from"./index-DjHjjRka.js";import{T as U}from"./index-D8ggGm6U.js";import{S as A}from"./index-D-mep5xd.js";import"./index-1hNFGOL1.js";import"./index-BhEU4BKS.js";import"./useVariants-Ze9mRC4L.js";import"./Table-B5D3q3rB.js";import"./iconUtil-DGEcPig7.js";import"./EllipsisOutlined-B-j67AQY.js";import"./Overflow-RRO2j2Cn.js";import"./index-B3yZo8E7.js";import"./index-B6k8cXum.js";import"./index-BC0FDAf3.js";import"./SearchOutlined-B1l8Mw2x.js";import"./index-BSWmn8Nf.js";import"./index-BdMcd5pB.js";import"./CheckOutlined-BbMCFcVc.js";import"./html2canvas.esm-CBrSDip1.js";function Ne(s){return de({tag:"svg",attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM14 11a1 1 0 011 1v1h1a1 1 0 110 2h-1v1a1 1 0 11-2 0v-1h-1a1 1 0 110-2h1v-1a1 1 0 011-1z"},child:[]}]})(s)}const da=()=>{const s=ce(),z=y(e=>{var t,l;return(l=(t=e.auth)==null?void 0:t.user)==null?void 0:l.userType}),{users:o,loading:f}=y(e=>e.users),{roles:d,loading:D}=y(e=>e.roles),{courses:n,loading:_}=y(e=>e.courses),[g]=r.useForm(),[m]=r.useForm(),[T]=r.useForm(),[H,b]=i.useState(!1),[K,v]=i.useState(!1),[V,C]=i.useState(!1),N=i.useMemo(()=>{var e,t;return(t=(e=o==null?void 0:o.newData)==null?void 0:e.filter(l=>(l==null?void 0:l.userType)!=="admin"))==null?void 0:t.map(l=>({...l,key:l==null?void 0:l._id,activeStatus:l!=null&&l.activeStatus?"Cho phép":"Chặn"}))},[o]),B=i.useMemo(()=>d.map(e=>({...e,key:e._id})),[d]),R=i.useMemo(()=>{var e;return(e=n==null?void 0:n.newData)==null?void 0:e.filter(t=>t.price!==0).map(t=>({key:t._id,label:t.name,value:t._id}))},[n]),L=i.useMemo(()=>{var e;return(e=n==null?void 0:n.newData)==null?void 0:e.filter(t=>t.price!==0).map(t=>({key:t._id,text:t.name,value:t._id}))},[n]),j=({searchText:e,searchedColumn:t})=>{e?c(s,be({[t]:e})):s(F({page:1,limit:localStorage.getItem("pageSize")||10}))},W=[{title:"Name",dataIndex:"name",width:"8%",editable:!1,...p({dataIndex:"name",handleTableChange:j})},{title:"Email",dataIndex:"email",width:"10%",editable:!1,...p({dataIndex:"email",handleTableChange:j})},{title:"Phone",dataIndex:"phone",width:"6%",editable:!1,...p({dataIndex:"phone",handleTableChange:j})},{title:"Gender",dataIndex:"gender",width:"4%",type:"select",editable:!1,...w("gender",[{value:"Nam",text:"Nam"},{value:"Nữ",text:"Nữ"}])},{title:"Active",dataIndex:"activeStatus",width:"5%",editable:!0,type:"select",optionSelect:[{value:!0,label:"Cho phép"},{value:!1,label:"Chặn"}],...w("activeStatus",[{value:"Cho phép",text:"Cho phép"},{value:"Chặn",text:"Chặn"}])},...z==="admin"?[{title:"Role",dataIndex:"userType",width:"5%",editable:!0,type:"select",optionSelect:Array.isArray(d)?d.map(e=>({value:e._id,label:e.nameRole})):[],...Array.isArray(d)&&d.length>0?w("userType",d.map(e=>({text:e.nameRole,value:e._id}))):{}}]:[],{title:"Day Cr",dataIndex:"createdAt",width:"5%",...Ce({dataIndex:"createdAt"}),render:e=>ke(e)},{title:a.jsxs("div",{className:"flex justify-center items-center gap-2",children:[a.jsx(S,{children:"Course"}),a.jsx(x,{onClick:()=>C(!0),icon:a.jsx(Ne,{size:25}),type:"text"})]}),children:[{title:a.jsx("div",{className:"text-center",children:"Add"}),width:"3%",editable:!1,render:(e,t)=>a.jsx("div",{className:"flex justify-center",children:a.jsx(x,{type:"text",icon:a.jsx(Ie,{size:20}),onClick:()=>{m.setFieldsValue(t),v(!0)}})})},{title:a.jsx("div",{className:"text-center",children:"Purchased courses"}),dataIndex:"courses",width:"10%",type:"select",editable:!1,...je("courses",L),render:(e,t)=>e==null?void 0:e.map((l,h)=>{var u;return l&&(n!=null&&n.newData)&&Array.isArray(n==null?void 0:n.newData)&&((u=n==null?void 0:n.newData)==null?void 0:u.length)>0?a.jsx(a.Fragment,{children:a.jsx("div",{className:"flex flex-col my-1",children:a.jsxs(De,{color:"warning",children:[" ",Fe(l,n==null?void 0:n.newData,"name")," "]})})}):null})}]}],G=[{title:"Tên quyền",dataIndex:"nameRole",width:"20%",editable:!0,...p({dataIndex:"nameRole"}),render:e=>a.jsx(S.Text,{ellipsis:{suffix:""},children:e})},{title:"Quản lý",dataIndex:"role",width:"40%",type:"select-multi",optionSelect:[{value:"adminWebsite",label:"Bài Viết"},{value:"adminCourses",label:"Khóa Học"},{value:"adminOrders",label:"Đơn Hàng"},{value:"adminFileManager",label:"File"}],editable:!0,...p({dataIndex:"name123"}),render:e=>a.jsx(a.Fragment,{children:a.jsx(we,{keywords:e})})}],Q=e=>{c(s,ue(e))},X=e=>{e.activeStatus=e.activeStatus==="Chặn"?!1:e.activeStatus==="Cho phép"?!0:e.activeStatus,c(s,q(e))},Y=e=>{c(s,pe(e),()=>{b(!1),g.resetFields()})},Z=e=>{c(s,xe(e))},$=e=>{c(s,fe(e))},J=e=>{e.id=e.key,c(s,q(e),()=>{v(!1)})},ee=e=>{E.putCourseByEmails(e).then(()=>{ye("put","Cập nhập thành công!"),C(!1)})};function ae({fetchOptions:e,debounceTimeout:t=800,...l}){const[h,u]=i.useState(!1),[le,M]=i.useState([]),k=i.useRef(0),ne=i.useMemo(()=>{const se=ie=>{k.current+=1;const re=k.current;M([]),u(!0),e(ie).then(oe=>{re===k.current&&(M(oe),u(!1))})};return Ae.debounce(se,t)},[e,t]);return a.jsx(A,{size:"large",filterOption:!1,onSearch:ne,notFoundContent:h?a.jsx(ge,{size:"small"}):null,...l,options:le})}async function te(e){var l;const t=await E.search({email:e});return console.log(t.newData),(l=t==null?void 0:t.newData)==null?void 0:l.map(h=>({label:h.email,value:h.email}))}return i.useEffect(()=>{f&&(s(F({page:1,limit:localStorage.getItem("pageSize")||10})),s(me()))},[]),i.useEffect(()=>{_===!0&&s(he())},[]),a.jsxs(ve,{header:"NGƯỜI DÙNG",button:a.jsxs(a.Fragment,{children:[a.jsx(x,{onClick:()=>b(!0),type:"primary",children:"Phân quyền"}),a.jsx(x,{onClick:()=>Se(N,"Users.xlsx"),type:"primary",children:"Xuất file Excel"})]}),children:[a.jsx(P,{Api:F,total:o==null?void 0:o.totalItems,dragMode:!1,width:"4%",loading:f,data:N,columns:W,onSave:X,onDelete:Q}),a.jsx(I,{centered:!0,open:H,onCancel:()=>b(!1),footer:null,width:750,children:a.jsx(Te,{centered:!0,items:[{label:"Thêm quyền quản trị",key:"1",children:a.jsx(a.Fragment,{children:a.jsxs(r,{form:g,name:"customForm",layout:"vertical",onFinish:Y,children:[a.jsx(r.Item,{className:"mb-3",name:"nameRole",label:"Tên quyền",rules:[{required:!0,message:"Nhập tên quyền!"}],children:a.jsx(O,{placeholder:"Nhập tên quyền"})}),a.jsx(r.Item,{className:"mb-3",name:"role",label:"Chức năng quản lý",rules:[{required:!0,message:"Chọn các quyền!"}],children:a.jsx(U,{treeDefaultExpandAll:!0,showSearch:!1,showCheckedStrategy:U.SHOW_PARENT,treeCheckable:!0,treeData:[{title:"Admin",value:"admin",key:"admin",children:[{key:"adminDashboard",value:"adminDashboard",label:"Trang chủ"},{key:"adminWebsite",value:"adminWebsite",label:"Bài Viết"},{key:"adminPlugins",value:"adminPlugins",label:"Plugins"},{key:"adminUsers",value:"adminUsers",label:"Người dùng"},{key:"adminWebsite",value:"adminCourses",label:"Khóa Học"},{key:"adminOrders",value:"adminOrders",label:"Đơn Hàng"},{key:"adminWebsite",value:"adminEmail",label:"Email"},{key:"adminFileManager",value:"adminFileManager",label:"File"},{key:"adminData",value:"adminData",label:"Dữ Liệu"},{key:"adminPayment",value:"adminPayment",label:"Key Thanh Toán"}]},{title:"User",value:"user",key:"user",children:[{title:"Trang chủ",value:"userDashboard",key:"userDashboard"},{title:"Thông tin",value:"userInfo",key:"userInfo"},{title:"Khóa học",value:"userCourses",key:"userCourses"},{title:"Lịch sử mua hàng",value:"userOrders",key:"userOrders"},{title:"Đổi mật khẩu",value:"userChangePassword",key:"userChangePassword"}]}],placeholder:"Chọn các quyền"})}),a.jsx(x,{type:"primary",loading:D,onClick:()=>g.submit(),className:"flex float-end",children:"Thêm quyền"})]})})},{label:"Chỉnh sửa quyền quản trị",key:"2",children:a.jsx(a.Fragment,{children:a.jsx(P,{loading:D,data:B,columns:G,scroll:{x:500,y:350},width:"10%",onSave:Z,onDelete:$})})}]})}),a.jsx(I,{title:a.jsxs(a.Fragment,{children:["Khóa học của học viên: ",a.jsx(S.Text,{type:"danger",children:m.getFieldValue("name")})]}),centered:!0,open:K,onOk:()=>{m.submit()},onCancel:()=>{v(!1),m.resetFields()},confirmLoading:f,width:600,children:a.jsxs(r,{form:m,name:"customFormCourses",layout:"vertical",onFinish:J,children:[a.jsx(r.Item,{className:"mb-4 hidden",name:"key",label:"Khóa học",rules:[{required:!0,message:"Chọn khóa học cần kích hoạt!"}],children:a.jsx(O,{})}),a.jsx(r.Item,{className:"mb-4",name:"courses",label:"Kích hoạt khóa học",children:a.jsx(A,{mode:"multiple",options:R,placeholder:"Chọn khóa học cần kích hoạt"})})]})}),a.jsx(I,{title:"Thêm nhiều khóa học cho học viên",centered:!0,open:V,onOk:()=>{T.submit()},onCancel:()=>C(!1),confirmLoading:f,width:600,children:a.jsxs(r,{form:T,name:"customFormMultiAdd",layout:"vertical",onFinish:ee,children:[a.jsx(r.Item,{className:"mb-4",name:"email",label:"Email người dùng",rules:[{required:!0,message:"Chọn email người dùng!"}],children:a.jsx(ae,{mode:"multiple",placeholder:"Nhập email người dùng",fetchOptions:te,style:{width:"100%"}})}),a.jsx(r.Item,{className:"mb-4",name:"courses",label:"Khóa học",rules:[{required:!0,message:"Chọn khóa học!"}],children:a.jsx(A,{size:"large",mode:"multiple",options:R,placeholder:"Chọn khóa học cần kích hoạt"})})]})})]})};export{da as default};
