import{e as K,d as q,r,j as e,o as N,k as h,i as d,t as w,m as P,n as O}from"./index-BowJM29w.js";import{b7 as X}from"./Layout-Domxp-nU.js";import{I as L}from"./index-B-lOeCq_.js";import{F as s}from"./index-2c4Yqg50.js";import{I as n}from"./index-B09ABVhj.js";import{B as l,M as $}from"./index-BXtN7Ba8.js";import{C as A}from"./index-B_IREkzk.js";import{T as M,R as H,C as f}from"./index-DUpMxO_p.js";import{S as R}from"./index-CMn2EtKM.js";import"./index-Dv-zdiuM.js";import"./index-BVdqRuSp.js";import"./index-DNEQPr7O.js";import"./Overflow-DCfbuFTb.js";import"./useVariants-CoiVlATJ.js";import"./index-8xL3IPSf.js";import"./CheckOutlined-h-6rnxuo.js";import"./SearchOutlined-C82Pbk8I.js";import"./EllipsisOutlined-C_y_mtCH.js";import"./index-Bzk0PBX-.js";import"./progress-Bl8RjiFD.js";const oe=()=>{const[o]=s.useForm(),[m]=s.useForm(),{token:{colorPrimary:C}}=K.useToken(),{user:i}=q(t=>t.auth),[v,c]=r.useState(!1),[a,p]=r.useState(0),[j,I]=r.useState(),[y,V]=r.useState(),[T,S]=r.useState(),E=t=>{const{newPassword:u,confirmPassword:k}=t;N("auth","Đang thay đổi mật khẩu..."),u!==k&&h("auth","Mật khẩu không trùng khớp!","Vui lòng kiểm tra lại mật khẩu của bạn!"),d.putPassWord(t).then(x=>{w("auth","Thay Đổi Mật Khẩu Thành Công!",x.message),o.resetFields()}).catch(x=>{h("auth","Thay Đổi Mật Khẩu Không Thành Công!",x.message)})},z=async t=>{(await d.checkEmail(t)).exists?(p(a+1),P.sig({id:O}).then(k=>{P.sendForgot({email:t.email,title:"Mã xác nhận",content:k.content})})):h("auth","Email không tồn tại!","Vui lòng kiểm tra lại email của bạn!")},F=()=>{d.checkCode({email:m.getFieldValue("email"),verify:j}).then(t=>{t.exists?p(a+1):h("auth","Mã Xác Nhận Không Đúng!","Vui lòng kiểm tra lại mã xác nhận của bạn!")})},b=()=>{const t=new Date;N(t,"Đang đổi mật khẩu"),y===T?d.putUserForgot({email:m.getFieldValue("email"),password:y,verify:j}).then(u=>{u&&(w(t,"Đổi mật khẩu thành công!","Hãy đăng nhập để trải nghiệm tốt nhất!"),c(!1))}):h(t,"Mật khẩu không trùng khớp!","Vui lòng kiểm tra lại mật khẩu của bạn!")},g=[{key:"1",title:"Xác nhận thông tin",content:e.jsx(e.Fragment,{children:e.jsx(s,{className:"mt-4",form:m,name:"formForgotPass",layout:"vertical",onFinish:z,children:e.jsx(s.Item,{label:"Email",className:"mb-4",name:"email",validateFirst:!0,rules:[{required:!0,message:"Vui lòng nhập email!"},{type:"email",message:"Email không đúng định dạng!"}],children:e.jsx(n,{size:"large",placeholder:"Nhập email để lấy lại mật khẩu",readOnly:!0})})})})},{key:"2",title:"Điền mã xác nhận",content:e.jsx(e.Fragment,{children:e.jsxs(s,{className:"mt-4",name:"sdfsdfsdfsdfsdfsdf",layout:"vertical",onFinish:F,children:[e.jsx(s.Item,{label:"Nhập mã xác nhận gửi về email bao gồm 6 chữ số",className:"mb-4 flex flex-col justify-center items-center flex-wrap",name:"otp",rules:[{required:!0,message:"Vui lòng nhập mã xác nhận!"}],children:e.jsx(n.OTP,{onChange:t=>I(t),size:"large",placeholder:"Nhập mã xác nhận"})}),e.jsx("div",{className:"flex justify-center gap-2",children:e.jsxs("span",{children:["Không thấy mã ",e.jsx(l,{icon:e.jsx(L,{}),style:{color:C},type:"text",children:"Gửi lại mã"})]})})]})})},{key:"3",title:"Đặt lại mật khẩu",content:e.jsx(e.Fragment,{children:e.jsxs(s,{className:"mt-4",name:"adssdfsdfsdf",layout:"vertical",onFinish:b,children:[e.jsx(s.Item,{label:"Mật khẩu mới",className:"mb-4",name:"password",validateFirst:!0,rules:[{required:!0,message:"Vui lòng nhập mật khẩu!"},{min:8,message:"Mật khẩu phải có ít nhất 8 ký tự!"},{pattern:/[!@#$%^&*(),.?":{}|<>]/,message:"Mật khẩu phải có ít nhất một ký tự đặc biệt!"}],children:e.jsx(n.Password,{size:"large",placeholder:"Nhập mật khẩu mới",onChange:t=>V(t.target.value)})}),e.jsx(s.Item,{label:"Xác nhận mật khẩu mới",className:"mb-4",name:"confirmPassword",validateFirst:!0,rules:[{required:!0,message:"Vui lòng nhập mật khẩu!"},{min:8,message:"Mật khẩu phải có ít nhất 8 ký tự!"},{pattern:/[!@#$%^&*(),.?":{}|<>]/,message:"Mật khẩu phải có ít nhất một ký tự đặc biệt!"}],children:e.jsx(n.Password,{size:"large",placeholder:"Nhập mật khẩu mới",onChange:t=>S(t.target.value)})})]})})}];return r.useEffect(()=>{i&&o.setFieldsValue({userId:i._id})},[i]),e.jsxs(X,{title:"Đổi mật khẩu",header:"ĐỔI MẬT KHẨU",button:e.jsx(e.Fragment,{children:e.jsx(l,{type:"primary",onClick:()=>o.submit(),children:"Đổi Mật Khẩu"})}),children:[e.jsx(A,{className:"h-full overflow-auto",title:e.jsxs("div",{className:"flex justify-between",children:[e.jsx(M.Text,{strong:!0,children:"Đổi mật khẩu"}),e.jsx(M.Link,{onClick:()=>{c(!0),m.setFieldsValue({email:i==null?void 0:i.email})},children:"Quên mật khẩu ?"})]}),children:e.jsx(s,{form:o,name:"customForm",layout:"vertical",onFinish:E,children:e.jsxs(H,{gutter:[14,14],children:[e.jsx(s.Item,{className:"mb-2 hidden",name:"userId",label:"id",children:e.jsx(n.Password,{size:"large",placeholder:"Nhập mật khẩu mới"})}),e.jsx(f,{xl:{span:24},span:24,children:e.jsx(s.Item,{className:"mb-2",name:"oldPassword",label:"Mật khẩu cũ",validateFirst:!0,rules:[{required:!0,message:"Vui lòng nhập mật khẩu!"},{min:8,message:"Mật khẩu phải có ít nhất 8 ký tự!"},{pattern:/[!@#$%^&*(),.?":{}|<>]/,message:"Mật khẩu phải có ít nhất một ký tự đặc biệt!"}],children:e.jsx(n.Password,{size:"large",placeholder:"Nhập mật khẩu cũ"})})}),e.jsx(f,{xl:{span:12},md:{span:12},span:24,children:e.jsx(s.Item,{className:"mb-2",name:"newPassword",label:"Mật khẩu mới",validateFirst:!0,rules:[{required:!0,message:"Vui lòng nhập mật khẩu!"},{min:8,message:"Mật khẩu phải có ít nhất 8 ký tự!"},{pattern:/[!@#$%^&*(),.?":{}|<>]/,message:"Mật khẩu phải có ít nhất một ký tự đặc biệt!"}],children:e.jsx(n.Password,{size:"large",placeholder:"Nhập mật khẩu mới"})})}),e.jsx(f,{xl:{span:12},md:{span:12},span:24,children:e.jsx(s.Item,{className:"mb-2",name:"confirmPassword",label:"Xác nhận mật khẩu",validateFirst:!0,rules:[{required:!0,message:"Vui lòng nhập mật khẩu!"},{min:8,message:"Mật khẩu phải có ít nhất 8 ký tự!"},{pattern:/[!@#$%^&*(),.?":{}|<>]/,message:"Mật khẩu phải có ít nhất một ký tự đặc biệt!"}],children:e.jsx(n.Password,{size:"large",placeholder:"Nhập lại mật khẩu mới"})})})]})})}),e.jsxs($,{title:"Quên mật khẩu",centered:!0,open:v,onOk:()=>c(!1),onCancel:()=>c(!1),footer:null,width:650,children:[e.jsx(R,{current:a,items:g}),e.jsx("div",{children:g[a].content}),e.jsxs("div",{className:"flex justify-end",style:{marginTop:24},children:[a>0&&e.jsx(l,{style:{margin:"0 8px"},onClick:()=>p(a-1),children:"Trở Lại"}),a==0&&e.jsx(l,{type:"primary",onClick:()=>m.submit(),children:" Gửi Email Xác Nhận"}),a==1&&e.jsx(l,{type:"primary",onClick:F,children:"Xác Nhận"}),a===g.length-1&&e.jsx(l,{type:"primary",onClick:b,children:" Đặt Lại Mật Khẩu "})]})]})]})};export{oe as default};
