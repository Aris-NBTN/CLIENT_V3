import{aa as de,q as me,s as y,r as s,j as a,ab as F,ac as ce,ad as he,a7 as m,ae as ue,af as q,ag as pe,ah as xe,ai as fe,B as E,t as ye,M as ge,aj as be}from"./index-CLgyQ1vx.js";import{b7 as ve}from"./Layout-Bo8X0zbn.js";import{E as P}from"./Table-BASKfIV3.js";import{F as p,a as w,b as Ce,c as je}from"./Filter-ByHhxKaB.js";import{d as ke,T as Fe,e as we,f as Ae}from"./Format-D-jAu6wH.js";import{e as Se}from"./export-nvQuuiWM.js";import{b as Ie}from"./index-DRxWoPIf.js";import{l as De}from"./lodash-2p3_sYnL.js";import{F as i}from"./index-BKrmvUfW.js";import{T as A}from"./index-ObwxId4A.js";import{B as x}from"./button-CFZW2Fak.js";import{M as S}from"./index-CL0RwYER.js";import{T as Te}from"./index-BbsGW53p.js";import{I as O}from"./index-DNERIO6W.js";import{T as U}from"./index-DB3utRo5.js";import{S as I}from"./index-BUe_r4_5.js";import"./index-CnibHaQp.js";import"./EllipsisOutlined-gz3vguox.js";import"./Overflow-aWC-KCIQ.js";import"./context-DZ0uDIsf.js";import"./index-BC037qWw.js";import"./index-DeFNh6Jp.js";import"./row-CbKX7NA9.js";import"./useLocale-WrgrvLJQ.js";import"./PurePanel-BuBTzN3G.js";import"./Dropdown-BhJCOC9m.js";import"./iconUtil-DMDmVrIZ.js";import"./compact-item-DR52_Oht.js";import"./index-BSB5CEy1.js";import"./index-DzniCgZh.js";import"./TextArea-Bz2hpPvr.js";import"./useVariants-Dd3vmZmf.js";import"./index-wxIFWymk.js";import"./index-C5fE5rqD.js";import"./SearchOutlined-DECFkpI7.js";import"./index-BjEFqTht.js";import"./index-C1zwpvBp.js";import"./html2canvas.esm-CBrSDip1.js";import"./jspdf.es.min-BIQw-QNZ.js";import"./CheckOutlined-DL5js1cp.js";function Ne(n){return de({tag:"svg",attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM14 11a1 1 0 011 1v1h1a1 1 0 110 2h-1v1a1 1 0 11-2 0v-1h-1a1 1 0 110-2h1v-1a1 1 0 011-1z"},child:[]}]})(n)}const ga=()=>{const n=me(),z=y(e=>{var t,r;return(r=(t=e.auth)==null?void 0:t.user)==null?void 0:r.userType}),{users:o,loading:f}=y(e=>e.users),{roles:d,loading:D}=y(e=>e.roles),{courses:l,loading:_}=y(e=>e.courses),[g]=i.useForm(),[c]=i.useForm(),[T]=i.useForm(),[B,b]=s.useState(!1),[H,v]=s.useState(!1),[K,C]=s.useState(!1),N=s.useMemo(()=>Array.isArray(o==null?void 0:o.newData)?o.newData.map(e=>({...e,key:e==null?void 0:e._id,activeStatus:e!=null&&e.activeStatus?"Cho phép":"Chặn"})):[],[o]),V=s.useMemo(()=>d.map(e=>({...e,key:e._id})),[d]),R=s.useMemo(()=>{var e;return(e=l==null?void 0:l.newData)==null?void 0:e.filter(t=>t.price!==0).map(t=>({key:t._id,label:t.name,value:t._id}))},[l]),L=s.useMemo(()=>{var e;return(e=l==null?void 0:l.newData)==null?void 0:e.filter(t=>t.price!==0).map(t=>({key:t._id,text:t.name,value:t._id}))},[l]),j=({searchText:e,searchedColumn:t})=>{e?m(n,be({[t]:e})):n(F({page:1,limit:localStorage.getItem("pageSize")||10}))},W=[{title:"Name",dataIndex:"name",width:"9%",editable:!1,...p({dataIndex:"name",handleTableChange:j})},{title:"Email",dataIndex:"email",width:"9%",editable:!1,...p({dataIndex:"email",handleTableChange:j})},{title:"Phone",dataIndex:"phone",width:"6%",editable:!1,...p({dataIndex:"phone",handleTableChange:j})},{title:"Gender",dataIndex:"gender",width:"4%",type:"select",editable:!1,...w("gender",[{value:"Nam",text:"Nam"},{value:"Nữ",text:"Nữ"}])},{title:"Active",dataIndex:"activeStatus",width:"5%",editable:!0,type:"select",optionSelect:[{value:!0,label:"Cho phép"},{value:!1,label:"Chặn"}],...w("activeStatus",[{value:"Cho phép",text:"Cho phép"},{value:"Chặn",text:"Chặn"}])},...z==="admin"?[{title:"Role",dataIndex:"userType",width:"5%",editable:!0,type:"select",optionSelect:Array.isArray(d)?d.map(e=>({value:e._id,label:e.nameRole})):[],...Array.isArray(d)&&d.length>0?w("userType",d.map(e=>({text:e.nameRole,value:e._id}))):{}}]:[],{title:"Day Cr",dataIndex:"createdAt",width:"5%",...Ce({dataIndex:"createdAt"}),render:e=>ke(e)},{title:a.jsxs("div",{className:"flex justify-center items-center gap-2",children:[a.jsx(A,{children:"Course"}),a.jsx(x,{onClick:()=>C(!0),icon:a.jsx(Ne,{size:25}),type:"text"})]}),children:[{title:a.jsx("div",{className:"text-center",children:"Add"}),width:"3%",editable:!1,render:(e,t)=>a.jsx("div",{className:"flex justify-center",children:a.jsx(x,{type:"text",icon:a.jsx(Ie,{size:20}),onClick:()=>{c.setFieldsValue(t),v(!0)}})})},{title:a.jsx("div",{className:"text-center",children:"Purchased courses"}),dataIndex:"courses",width:"10%",type:"select",editable:!1,...je("courses",L),render:(e,t)=>e==null?void 0:e.map((r,h)=>{var u;return r&&(l!=null&&l.newData)&&Array.isArray(l==null?void 0:l.newData)&&((u=l==null?void 0:l.newData)==null?void 0:u.length)>0?a.jsx(a.Fragment,{children:a.jsx("div",{className:"flex flex-col my-1",children:a.jsxs(Fe,{color:"warning",children:[" ",we(r,l==null?void 0:l.newData,"name")," "]})})}):null})}]}],G=[{title:"Tên quyền",dataIndex:"nameRole",width:"20%",editable:!0,...p({dataIndex:"nameRole"}),render:e=>a.jsx(A.Text,{ellipsis:{suffix:""},children:e})},{title:"Quản lý",dataIndex:"role",width:"40%",type:"select-multi",optionSelect:[{value:"adminWebsite",label:"Bài Viết"},{value:"adminCourses",label:"Khóa Học"},{value:"adminOrders",label:"Đơn Hàng"},{value:"adminFileManager",label:"File"}],editable:!0,...p({dataIndex:"name123"}),render:e=>a.jsx(a.Fragment,{children:a.jsx(Ae,{keywords:e})})}],Q=e=>{m(n,ue(e))},X=e=>{e.activeStatus=e.activeStatus==="Chặn"?!1:e.activeStatus==="Cho phép"?!0:e.activeStatus,m(n,q(e))},J=e=>{m(n,pe(e),()=>{b(!1),g.resetFields()})},Y=e=>{m(n,xe(e))},Z=e=>{m(n,fe(e))},$=e=>{e.id=e.key,m(n,q(e),()=>{v(!1)})},ee=e=>{E.putCourseByEmails(e).then(()=>{ye("put","Cập nhập thành công!"),C(!1)})};function ae({fetchOptions:e,debounceTimeout:t=800,...r}){const[h,u]=s.useState(!1),[le,M]=s.useState([]),k=s.useRef(0),ne=s.useMemo(()=>{const se=ie=>{k.current+=1;const re=k.current;M([]),u(!0),e(ie).then(oe=>{re===k.current&&(M(oe),u(!1))})};return De.debounce(se,t)},[e,t]);return a.jsx(I,{size:"large",filterOption:!1,onSearch:ne,notFoundContent:h?a.jsx(ge,{size:"small"}):null,...r,options:le})}async function te(e){var r;const t=await E.search({email:e});return console.log(t.newData),(r=t==null?void 0:t.newData)==null?void 0:r.map(h=>({label:h.email,value:h.email}))}return s.useEffect(()=>{f&&(n(F({page:1,limit:localStorage.getItem("pageSize")||10})),n(ce()))},[]),s.useEffect(()=>{_===!0&&n(he())},[]),a.jsxs(ve,{header:"NGƯỜI DÙNG",button:a.jsxs(a.Fragment,{children:[a.jsx(x,{onClick:()=>b(!0),type:"primary",children:"Phân quyền"}),a.jsx(x,{onClick:()=>Se(N,"Users.xlsx"),type:"primary",children:"Xuất file Excel"})]}),children:[a.jsx(P,{Api:F,total:o==null?void 0:o.totalItems,dragMode:!1,width:"4%",loading:f,data:N,columns:W,onSave:X,onDelete:Q}),a.jsx(S,{centered:!0,open:B,onCancel:()=>b(!1),footer:null,width:750,children:a.jsx(Te,{centered:!0,items:[{label:"Thêm quyền quản trị",key:"1",children:a.jsx(a.Fragment,{children:a.jsxs(i,{form:g,name:"customForm",layout:"vertical",onFinish:J,children:[a.jsx(i.Item,{className:"mb-3",name:"nameRole",label:"Tên quyền",rules:[{required:!0,message:"Nhập tên quyền!"}],children:a.jsx(O,{placeholder:"Nhập tên quyền"})}),a.jsx(i.Item,{className:"mb-3",name:"role",label:"Chức năng quản lý",rules:[{required:!0,message:"Chọn các quyền!"}],children:a.jsx(U,{treeDefaultExpandAll:!0,showSearch:!1,showCheckedStrategy:U.SHOW_PARENT,treeCheckable:!0,treeData:[{title:"Admin",value:"admin",key:"admin",children:[{key:"adminDashboard",value:"adminDashboard",label:"Trang chủ"},{key:"adminWebsite",value:"adminWebsite",label:"Bài Viết"},{key:"adminPlugins",value:"adminPlugins",label:"Plugins"},{key:"adminUsers",value:"adminUsers",label:"Người dùng"},{key:"adminWebsite",value:"adminCourses",label:"Khóa Học"},{key:"adminOrders",value:"adminOrders",label:"Đơn Hàng"},{key:"adminWebsite",value:"adminEmail",label:"Email"},{key:"adminFileManager",value:"adminFileManager",label:"File"},{key:"adminData",value:"adminData",label:"Dữ Liệu"},{key:"adminPayment",value:"adminPayment",label:"Key Thanh Toán"}]},{title:"User",value:"user",key:"user",children:[{title:"Trang chủ",value:"userDashboard",key:"userDashboard"},{title:"Thông tin",value:"userInfo",key:"userInfo"},{title:"Khóa học",value:"userCourses",key:"userCourses"},{title:"Lịch sử mua hàng",value:"userOrders",key:"userOrders"},{title:"Đổi mật khẩu",value:"userChangePassword",key:"userChangePassword"}]}],placeholder:"Chọn các quyền"})}),a.jsx(x,{type:"primary",loading:D,onClick:()=>g.submit(),className:"flex float-end",children:"Thêm quyền"})]})})},{label:"Chỉnh sửa quyền quản trị",key:"2",children:a.jsx(a.Fragment,{children:a.jsx(P,{loading:D,data:V,columns:G,scroll:{x:500,y:350},width:"10%",onSave:Y,onDelete:Z})})}]})}),a.jsx(S,{title:a.jsxs(a.Fragment,{children:["Khóa học của học viên: ",a.jsx(A.Text,{type:"danger",children:c.getFieldValue("name")})]}),centered:!0,open:H,onOk:()=>{c.submit()},onCancel:()=>{v(!1),c.resetFields()},confirmLoading:f,width:600,children:a.jsxs(i,{form:c,name:"customFormCourses",layout:"vertical",onFinish:$,children:[a.jsx(i.Item,{className:"mb-4 hidden",name:"key",label:"Khóa học",rules:[{required:!0,message:"Chọn khóa học cần kích hoạt!"}],children:a.jsx(O,{})}),a.jsx(i.Item,{className:"mb-4",name:"courses",label:"Kích hoạt khóa học",children:a.jsx(I,{mode:"multiple",options:R,placeholder:"Chọn khóa học cần kích hoạt"})})]})}),a.jsx(S,{title:"Thêm nhiều khóa học cho học viên",centered:!0,open:K,onOk:()=>{T.submit()},onCancel:()=>C(!1),confirmLoading:f,width:600,children:a.jsxs(i,{form:T,name:"customFormMultiAdd",layout:"vertical",onFinish:ee,children:[a.jsx(i.Item,{className:"mb-4",name:"email",label:"Email người dùng",rules:[{required:!0,message:"Chọn email người dùng!"}],children:a.jsx(ae,{mode:"multiple",placeholder:"Nhập email người dùng",fetchOptions:te,style:{width:"100%"}})}),a.jsx(i.Item,{className:"mb-4",name:"courses",label:"Khóa học",rules:[{required:!0,message:"Chọn khóa học!"}],children:a.jsx(I,{size:"large",mode:"multiple",options:R,placeholder:"Chọn khóa học cần kích hoạt"})})]})})]})};export{ga as default};
