import{r as o,c as w,d as p,h as R,b1 as k,b2 as q,b3 as I,j as d,k as g,o as O,b4 as W,t as G}from"./index-CPBF7azd.js";import{b7 as J}from"./Layout-6kY_fdgg.js";import{P as N,p as U,b as _,a as z,B as a}from"./index-B_TJ8Zit.js";import{p as K,a as Q,S as B}from"./index-BLZGZfSB.js";import"./index-BHMnDpbp.js";import"./index-DyMsIEIg.js";import"./useVariants-Ze9mRC4L.js";import"./EllipsisOutlined-B-j67AQY.js";import"./Overflow-RRO2j2Cn.js";import"./CheckOutlined-BbMCFcVc.js";import"./index-8AvD9LWa.js";import"./index-1hNFGOL1.js";import"./index-BhEU4BKS.js";import"./index-D-mep5xd.js";import"./index-B6k8cXum.js";import"./SearchOutlined-B1l8Mw2x.js";import"./fileApi-Ckv0JrL5.js";const dt=()=>{var E,v;const[C,j]=o.useState(""),[h,T]=o.useState(!1),f=w(),S=p(t=>t.pluginsScript.pluginsScript),M=p(t=>t.pluginsScript.loading),{plugins:i,loading:b}=p(t=>t.plugins),{pluginsScript:D}=p(t=>t.pluginsScript),$=o.useMemo(()=>{var t;return(t=i==null?void 0:i.newData)==null?void 0:t.map(s=>({id:s.id,src:`${R}/uploads/${s.src}`}))},[i]),A=(t,s)=>{const n=new Date,{html:r,css:l,js:e}=s,x=new DOMParser().parseFromString(r,"text/html"),c=x.querySelector("#Header"),m=x.querySelector("#Footer");let y="",L="";const P=r.match(/<body[^>]*>([\s\S]*?)<\/body>/i);if(P&&P[1].trim()===""&&console.log("không có dữ liệu"),!c){g("Chưa có Header!");return}if(!m){g("Chưa có Footer!");return}c&&(y=`<div class="${c.className}">${c.innerHTML}</div>`),m&&(L=`<div id="Footer">${m.innerHTML}</div>`),O(n,"Đang cập nhật..."),k.putLayout(W,{header:y,footer:L,css:l,js:e,edit:t}).then(()=>{G(n,"Cập nhật thành công")}).catch(H=>{g(H.response.data.message)})},F=t=>{t.loadProjectData(C.edit);const s=["video","map","video","bootstrapIcon","map","model-3D","Masonry","quote","link-block","text-basic","text-section","column1","column2","column3","column3-7"],n=["gjs-open-import-webpage","open-templates","link-page","export-template"],r=["Extra","Blog","Layout","Short Codes"],{models:l}=t.BlockManager.getCategories();s.forEach(e=>t.BlockManager.remove(e)),n.forEach(e=>{t.Panels.removeButton("options",e)}),l.forEach(e=>{var u;return r.includes((u=e.get)==null?void 0:u.call(e,"id"))&&e.set("open",!1)})};return o.useEffect(()=>{k.getLayoutEdit().then(t=>{j(t[0]),T(!0)})},[]),o.useEffect(()=>{M===!0&&f(q())},[]),o.useEffect(()=>{b===!0&&f(I())},[]),d.jsxs(J,{margin:0,header:"BỐ CỤC WEBSITE",children:[!h&&d.jsx("div",{children:"LOAdding"}),h&&!b&&d.jsx(N,{height:"calc(100vh - 56px)",configGrapeJs:F,scripts:(E=S[0])==null?void 0:E.scripts,styles:(v=S[0])==null?void 0:v.styles,pluginss:$,plugins:[U,_,z,K,Q,a.imageLink,a.header,a.footer,a.container,a.user,B.customType,B.customTypeSelect],canvas:D[0],savePage:A})]})};export{dt as default};
