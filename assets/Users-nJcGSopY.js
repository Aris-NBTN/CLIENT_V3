import{a8 as de,q as me,s as y,r as i,j as a,a9 as F,aa as ce,ab as he,a5 as m,ac as ue,ad as q,ae as pe,af as xe,ag as fe,B as E,t as ye,M as ge,ah as be}from"./index-CaETGd4H.js";import{b7 as ve}from"./Layout-DMCYjNN5.js";import{E as P}from"./Table-Dj_ieaVo.js";import{F as p,a as w,b as Ce,c as je}from"./Filter-Bi9M1aPR.js";import{d as ke,e as Fe,f as we}from"./Format-De7xR3Ef.js";import{e as Ae}from"./export-DmiVRW_p.js";import{b as Se}from"./index-DOXKbhtK.js";import{l as Ie}from"./lodash-BS-WPmb9.js";import{F as s}from"./index-BNkAlLg_.js";import{T as A}from"./index-BvgbevL2.js";import{B as x}from"./TextArea-DL9E7QDS.js";import{T as De}from"./index-CirsKE9O.js";import{M as S}from"./index-BwhcdQ30.js";import{T as Te}from"./index-fxAJc3ok.js";import{I as O}from"./index-C952P3I9.js";import{T as U}from"./index-Dcyld_ap.js";import{S as I}from"./index-B2rD1-B1.js";import"./index-B62C_hIZ.js";import"./EllipsisOutlined-DpLw87te.js";import"./Overflow-Cq5KU3-G.js";import"./context-CAOTC38D.js";import"./index-C2L7NrrJ.js";import"./index-VFH58Qy_.js";import"./row-DEKWsijG.js";import"./useLocale-GZyPud6I.js";import"./PurePanel-BeFX9E72.js";import"./index-VvIhGa6T.js";import"./Dropdown-Ex9EsV8x.js";import"./Table-gyKg5Bvb.js";import"./styleChecker-BtECRdwW.js";import"./iconUtil-BW7oVKED.js";import"./useVariants-CICMN0jD.js";import"./index-Dj_HvkFD.js";import"./index-DkJhzmJq.js";import"./index-EkK5Af3H.js";import"./index-C1rlucz4.js";import"./SearchOutlined-49DpsCXx.js";import"./index-CqsyP2ea.js";import"./index-C-vxEhE8.js";import"./html2canvas.esm-CBrSDip1.js";import"./jspdf.es.min-D0YUJjrx.js";import"./CheckOutlined-BMludgPW.js";function Ne(n){return de({tag:"svg",attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM14 11a1 1 0 011 1v1h1a1 1 0 110 2h-1v1a1 1 0 11-2 0v-1h-1a1 1 0 110-2h1v-1a1 1 0 011-1z"},child:[]}]})(n)}const va=()=>{const n=me(),z=y(e=>{var t,r;return(r=(t=e.auth)==null?void 0:t.user)==null?void 0:r.userType}),{users:o,loading:f}=y(e=>e.users),{roles:d,loading:D}=y(e=>e.roles),{courses:l,loading:_}=y(e=>e.courses),[g]=s.useForm(),[c]=s.useForm(),[T]=s.useForm(),[B,b]=i.useState(!1),[H,v]=i.useState(!1),[K,C]=i.useState(!1),N=i.useMemo(()=>Array.isArray(o==null?void 0:o.newData)?o.newData.filter(e=>(e==null?void 0:e.userType)!=="admin").map(e=>({...e,key:e==null?void 0:e._id,activeStatus:e!=null&&e.activeStatus?"Cho phép":"Chặn"})):[],[o]),V=i.useMemo(()=>d.map(e=>({...e,key:e._id})),[d]),R=i.useMemo(()=>{var e;return(e=l==null?void 0:l.newData)==null?void 0:e.filter(t=>t.price!==0).map(t=>({key:t._id,label:t.name,value:t._id}))},[l]),L=i.useMemo(()=>{var e;return(e=l==null?void 0:l.newData)==null?void 0:e.filter(t=>t.price!==0).map(t=>({key:t._id,text:t.name,value:t._id}))},[l]),j=({searchText:e,searchedColumn:t})=>{e?m(n,be({[t]:e})):n(F({page:1,limit:localStorage.getItem("pageSize")||10}))},W=[{title:"Name",dataIndex:"name",width:"8%",editable:!1,...p({dataIndex:"name",handleTableChange:j})},{title:"Email",dataIndex:"email",width:"10%",editable:!1,...p({dataIndex:"email",handleTableChange:j})},{title:"Phone",dataIndex:"phone",width:"6%",editable:!1,...p({dataIndex:"phone",handleTableChange:j})},{title:"Gender",dataIndex:"gender",width:"4%",type:"select",editable:!1,...w("gender",[{value:"Nam",text:"Nam"},{value:"Nữ",text:"Nữ"}])},{title:"Active",dataIndex:"activeStatus",width:"5%",editable:!0,type:"select",optionSelect:[{value:!0,label:"Cho phép"},{value:!1,label:"Chặn"}],...w("activeStatus",[{value:"Cho phép",text:"Cho phép"},{value:"Chặn",text:"Chặn"}])},...z==="admin"?[{title:"Role",dataIndex:"userType",width:"5%",editable:!0,type:"select",optionSelect:Array.isArray(d)?d.map(e=>({value:e._id,label:e.nameRole})):[],...Array.isArray(d)&&d.length>0?w("userType",d.map(e=>({text:e.nameRole,value:e._id}))):{}}]:[],{title:"Day Cr",dataIndex:"createdAt",width:"5%",...Ce({dataIndex:"createdAt"}),render:e=>ke(e)},{title:a.jsxs("div",{className:"flex justify-center items-center gap-2",children:[a.jsx(A,{children:"Course"}),a.jsx(x,{onClick:()=>C(!0),icon:a.jsx(Ne,{size:25}),type:"text"})]}),children:[{title:a.jsx("div",{className:"text-center",children:"Add"}),width:"3%",editable:!1,render:(e,t)=>a.jsx("div",{className:"flex justify-center",children:a.jsx(x,{type:"text",icon:a.jsx(Se,{size:20}),onClick:()=>{c.setFieldsValue(t),v(!0)}})})},{title:a.jsx("div",{className:"text-center",children:"Purchased courses"}),dataIndex:"courses",width:"10%",type:"select",editable:!1,...je("courses",L),render:(e,t)=>e==null?void 0:e.map((r,h)=>{var u;return r&&(l!=null&&l.newData)&&Array.isArray(l==null?void 0:l.newData)&&((u=l==null?void 0:l.newData)==null?void 0:u.length)>0?a.jsx(a.Fragment,{children:a.jsx("div",{className:"flex flex-col my-1",children:a.jsxs(De,{color:"warning",children:[" ",Fe(r,l==null?void 0:l.newData,"name")," "]})})}):null})}]}],G=[{title:"Tên quyền",dataIndex:"nameRole",width:"20%",editable:!0,...p({dataIndex:"nameRole"}),render:e=>a.jsx(A.Text,{ellipsis:{suffix:""},children:e})},{title:"Quản lý",dataIndex:"role",width:"40%",type:"select-multi",optionSelect:[{value:"adminWebsite",label:"Bài Viết"},{value:"adminCourses",label:"Khóa Học"},{value:"adminOrders",label:"Đơn Hàng"},{value:"adminFileManager",label:"File"}],editable:!0,...p({dataIndex:"name123"}),render:e=>a.jsx(a.Fragment,{children:a.jsx(we,{keywords:e})})}],Q=e=>{m(n,ue(e))},X=e=>{e.activeStatus=e.activeStatus==="Chặn"?!1:e.activeStatus==="Cho phép"?!0:e.activeStatus,m(n,q(e))},J=e=>{m(n,pe(e),()=>{b(!1),g.resetFields()})},Y=e=>{m(n,xe(e))},Z=e=>{m(n,fe(e))},$=e=>{e.id=e.key,m(n,q(e),()=>{v(!1)})},ee=e=>{E.putCourseByEmails(e).then(()=>{ye("put","Cập nhập thành công!"),C(!1)})};function ae({fetchOptions:e,debounceTimeout:t=800,...r}){const[h,u]=i.useState(!1),[le,M]=i.useState([]),k=i.useRef(0),ne=i.useMemo(()=>{const ie=se=>{k.current+=1;const re=k.current;M([]),u(!0),e(se).then(oe=>{re===k.current&&(M(oe),u(!1))})};return Ie.debounce(ie,t)},[e,t]);return a.jsx(I,{size:"large",filterOption:!1,onSearch:ne,notFoundContent:h?a.jsx(ge,{size:"small"}):null,...r,options:le})}async function te(e){var r;const t=await E.search({email:e});return console.log(t.newData),(r=t==null?void 0:t.newData)==null?void 0:r.map(h=>({label:h.email,value:h.email}))}return i.useEffect(()=>{f&&(n(F({page:1,limit:localStorage.getItem("pageSize")||10})),n(ce()))},[]),i.useEffect(()=>{_===!0&&n(he())},[]),a.jsxs(ve,{header:"NGƯỜI DÙNG",button:a.jsxs(a.Fragment,{children:[a.jsx(x,{onClick:()=>b(!0),type:"primary",children:"Phân quyền"}),a.jsx(x,{onClick:()=>Ae(N,"Users.xlsx"),type:"primary",children:"Xuất file Excel"})]}),children:[a.jsx(P,{Api:F,total:o==null?void 0:o.totalItems,dragMode:!1,width:"4%",loading:f,data:N,columns:W,onSave:X,onDelete:Q}),a.jsx(S,{centered:!0,open:B,onCancel:()=>b(!1),footer:null,width:750,children:a.jsx(Te,{centered:!0,items:[{label:"Thêm quyền quản trị",key:"1",children:a.jsx(a.Fragment,{children:a.jsxs(s,{form:g,name:"customForm",layout:"vertical",onFinish:J,children:[a.jsx(s.Item,{className:"mb-3",name:"nameRole",label:"Tên quyền",rules:[{required:!0,message:"Nhập tên quyền!"}],children:a.jsx(O,{placeholder:"Nhập tên quyền"})}),a.jsx(s.Item,{className:"mb-3",name:"role",label:"Chức năng quản lý",rules:[{required:!0,message:"Chọn các quyền!"}],children:a.jsx(U,{treeDefaultExpandAll:!0,showSearch:!1,showCheckedStrategy:U.SHOW_PARENT,treeCheckable:!0,treeData:[{title:"Admin",value:"admin",key:"admin",children:[{key:"adminDashboard",value:"adminDashboard",label:"Trang chủ"},{key:"adminWebsite",value:"adminWebsite",label:"Bài Viết"},{key:"adminPlugins",value:"adminPlugins",label:"Plugins"},{key:"adminUsers",value:"adminUsers",label:"Người dùng"},{key:"adminWebsite",value:"adminCourses",label:"Khóa Học"},{key:"adminOrders",value:"adminOrders",label:"Đơn Hàng"},{key:"adminWebsite",value:"adminEmail",label:"Email"},{key:"adminFileManager",value:"adminFileManager",label:"File"},{key:"adminData",value:"adminData",label:"Dữ Liệu"},{key:"adminPayment",value:"adminPayment",label:"Key Thanh Toán"}]},{title:"User",value:"user",key:"user",children:[{title:"Trang chủ",value:"userDashboard",key:"userDashboard"},{title:"Thông tin",value:"userInfo",key:"userInfo"},{title:"Khóa học",value:"userCourses",key:"userCourses"},{title:"Lịch sử mua hàng",value:"userOrders",key:"userOrders"},{title:"Đổi mật khẩu",value:"userChangePassword",key:"userChangePassword"}]}],placeholder:"Chọn các quyền"})}),a.jsx(x,{type:"primary",loading:D,onClick:()=>g.submit(),className:"flex float-end",children:"Thêm quyền"})]})})},{label:"Chỉnh sửa quyền quản trị",key:"2",children:a.jsx(a.Fragment,{children:a.jsx(P,{loading:D,data:V,columns:G,scroll:{x:500,y:350},width:"10%",onSave:Y,onDelete:Z})})}]})}),a.jsx(S,{title:a.jsxs(a.Fragment,{children:["Khóa học của học viên: ",a.jsx(A.Text,{type:"danger",children:c.getFieldValue("name")})]}),centered:!0,open:H,onOk:()=>{c.submit()},onCancel:()=>{v(!1),c.resetFields()},confirmLoading:f,width:600,children:a.jsxs(s,{form:c,name:"customFormCourses",layout:"vertical",onFinish:$,children:[a.jsx(s.Item,{className:"mb-4 hidden",name:"key",label:"Khóa học",rules:[{required:!0,message:"Chọn khóa học cần kích hoạt!"}],children:a.jsx(O,{})}),a.jsx(s.Item,{className:"mb-4",name:"courses",label:"Kích hoạt khóa học",children:a.jsx(I,{mode:"multiple",options:R,placeholder:"Chọn khóa học cần kích hoạt"})})]})}),a.jsx(S,{title:"Thêm nhiều khóa học cho học viên",centered:!0,open:K,onOk:()=>{T.submit()},onCancel:()=>C(!1),confirmLoading:f,width:600,children:a.jsxs(s,{form:T,name:"customFormMultiAdd",layout:"vertical",onFinish:ee,children:[a.jsx(s.Item,{className:"mb-4",name:"email",label:"Email người dùng",rules:[{required:!0,message:"Chọn email người dùng!"}],children:a.jsx(ae,{mode:"multiple",placeholder:"Nhập email người dùng",fetchOptions:te,style:{width:"100%"}})}),a.jsx(s.Item,{className:"mb-4",name:"courses",label:"Khóa học",rules:[{required:!0,message:"Chọn khóa học!"}],children:a.jsx(I,{size:"large",mode:"multiple",options:R,placeholder:"Chọn khóa học cần kích hoạt"})})]})})]})};export{va as default};
