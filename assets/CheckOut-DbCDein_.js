import{C as R,c as B,d as S,r as a,D as Y,A as Z,a as ee,g as se,E as ne,j as e,N as te,o as ae,F as z,k as re}from"./index-D4WFe0GN.js";import{L as le}from"./Layout-C7uF3nVg.js";import{F as ie,a as oe,b as ce,c as k}from"./Format-jaW50eXH.js";import{p as D}from"./provinceVNApi-CHXEJKg-.js";import{F as d}from"./index-BHR7qeim.js";import{R as _,C,T as n}from"./index-B45XX2tT.js";import{C as H}from"./index-_tv4eCEQ.js";import{I as T}from"./index-CpMTn5gx.js";import{S as q}from"./index-CdFHtipV.js";import{D as p}from"./index-Sb-r2VRr.js";import{E as K}from"./index-DXVeFXOB.js";import{B as F,M as he}from"./index-tnIYc3TH.js";import"./index-4f-FJmpp.js";import"./EllipsisOutlined-Bcc_9XSq.js";import"./Overflow-BRo9Oe4s.js";import"./useVariants-BgAnyoUX.js";import"./CheckOutlined-DUQaWNAB.js";import"./index-BXYYrpTb.js";import"./SearchOutlined-BG_oG3O1.js";const U="v1/payment",de=async()=>await R.post(`${U}/momo`),me=async u=>await R.post(`${U}/bank`,u),O={MoMo:de,Bank:me},pe=()=>{const u=B(),{cart:x}=S(m=>m.cart),c=S(m=>m.auth.user),[r,y]=a.useState([]),[P,h]=a.useState(0),[E,I]=a.useState(0),[v,g]=a.useState(0),[b,w]=a.useState(!0);return a.useEffect(()=>{const m=x==null?void 0:x.filter(i=>{var j;return(j=c==null?void 0:c.courses)==null?void 0:j.includes(i)});m.length>0&&m.forEach(i=>{u(Y(i))});const L=i=>i.map(j=>({...j,price:j.price*(1-j.sale/100)}));Z.cart({ids:x}).then(i=>{y(L(i)),h(ie(i)),g(oe(i)),I(ce(i)),w(!1)}).catch(()=>{w(!1)})},[x,u,c]),{carts:r,estimated:P,total:E,discountedTotal:v,loading:b}},ze=()=>{var A,M,V;const u=ee(),x=B(),[c]=d.useForm(),r=S(s=>{var l;return(l=s.auth)==null?void 0:l.user}),{info:y,loading:P}=S(s=>s.info),[h,E]=a.useState(""),[I,v]=a.useState(!1),{carts:g,total:b}=pe(),[w,m]=a.useState(),[L,i]=a.useState([]),[j,W]=a.useState([]),[X,$]=a.useState([]),G=s=>{v(!0),m(s)},Q=async s=>{ae("","Đang xử lý thanh toán");const{name:l}=r,o=g.map(t=>({id:t._id,name:t.name,price:t.price,quantity:1})),f=Number(String(Date.now()).slice(-3)+String(Math.floor(Math.random()*1e3)).slice(-3));s.product=o,s.idUser=r._id;try{const t=await z.check({id:r._id,product:o,data:s});if(t.urlPayment==""){const{url:N}=await O.Bank({id:f,product:o,total:b,name:l});z.putOrderId({id:t._id,urlPayment:N,idOrderNew:f}).then(J=>{m(J),window.location.href=N})}else window.location.href=t.urlPayment}catch{const{url:N}=await O.Bank({id:f,product:o,total:b,name:l});s.urlPayment=N,s.orderId=f,z.add(s).then(()=>{window.location.href=N}).catch(()=>{re("","Thanh toán thất bại")})}};return a.useEffect(()=>{P&&x(se())},[]),a.useEffect(()=>{ne.get().then(s=>{E(s[0])})},[]),a.useEffect(()=>{D.province().then(s=>{const l=s.map(o=>({label:o.name,value:o.name,key:o.code}));i(l)})},[]),a.useEffect(()=>{r!=null&&r._id&&c.setFieldsValue({name:r.name,phone:r.phone,email:r.email})},[r]),e.jsxs(le,{title:"Thanh toán",children:[e.jsx("section",{children:e.jsxs(_,{gutter:[24,24],children:[e.jsx(C,{span:24,xl:{span:17},lg:{span:15},md:{span:24,order:1},xs:{order:2},children:e.jsx(H,{children:e.jsxs(d,{scrollToFirstError:!0,form:c,name:"customForm",layout:"vertical",onFinish:G,children:[e.jsx(d.Item,{className:"mb-4",name:"name",label:"Họ và tên",rules:[{required:!0,message:"Nhập họ và tên!"}],children:e.jsx(T,{size:"large",placeholder:"Nhập họ và tên"})}),e.jsx(d.Item,{className:"mb-4",name:"phone",label:"Số điện thoại",validateFirst:!0,rules:[{required:!0,message:"Vui lòng nhập số điện thoại!"},{pattern:/^0/,message:"Số điện thoại phải bắt đầu bằng số 0!"},{len:10,message:"Số điện thoại phải có đúng 10 số!"}],children:e.jsx(T,{size:"large",placeholder:"Nhập số điện thoại",onKeyPress:s=>{/[0-9]/.test(s.key)||s.preventDefault()}})}),e.jsx(d.Item,{className:"mb-4",name:"email",label:"Email",validateFirst:!0,rules:[{required:!0,message:"Vui lòng nhập email!"},{type:"email",message:"Email không đúng định dạng!"}],children:e.jsx(T,{size:"large",placeholder:"Nhập email"})}),e.jsxs(_,{gutter:[24,24],children:[e.jsx(C,{md:{span:8},span:24,children:e.jsx(d.Item,{className:"mb-2",name:"province",label:"Tỉnh/Thành phố",rules:[{required:!0,message:"Chọn tỉnh hoặc thành phố!"}],children:e.jsx(q,{showSearch:!0,optionFilterProp:"label",size:"large",className:"mb-2",placeholder:"Chọn tỉnh hoặc thành phố",options:L,onChange:(s,l)=>{D.district(l.key).then(o=>{const f=o.map(t=>({label:t.name,value:t.name,key:t.code}));W(f),c.setFieldsValue({district:void 0}),c.setFieldsValue({ward:void 0})})}})})}),e.jsx(C,{md:{span:8},span:24,children:e.jsx(d.Item,{className:"mb-2",name:"district",label:"Quận/Huyện",rules:[{required:!0,message:"Chọn quận hoặc huyện!"}],children:e.jsx(q,{showSearch:!0,optionFilterProp:"label",size:"large",className:"mb-2",placeholder:"Chọn quận hoặc huyện",options:j,onChange:(s,l)=>{D.ward(l.key).then(o=>{const f=o.map(t=>({label:t.name,value:t.name,key:t.code}));$(f),c.setFieldsValue({ward:void 0})})}})})}),e.jsx(C,{md:{span:8},span:24,children:e.jsx(d.Item,{className:"mb-2",name:"ward",label:"Xã/Phường",rules:[{required:!0,message:"Chọn xã hoặc phường!"}],children:e.jsx(q,{showSearch:!0,optionFilterProp:"label",size:"large",className:"mb-2",placeholder:"Chọn xã hoặc phường",options:X})})})]}),e.jsx(d.Item,{className:"mb-4",name:"address",label:"Địa chỉ",rules:[{required:!0,message:"Nhập địa chỉ!"}],children:e.jsx(T,{size:"large",placeholder:"Nhập địa chỉ"})}),e.jsx(d.Item,{className:"mb-0",name:"note",label:"Ghi chú",children:e.jsx(T.TextArea,{style:{height:120,minHeight:190},size:"large",placeholder:"Nhập ghi chú"})})]})})}),e.jsx(C,{className:"mx-auto",span:24,xl:{span:7},lg:{span:9},md:{span:14,order:2},xs:{order:1},children:e.jsxs(H,{className:"sticky top-24",children:[e.jsx(p,{className:"!mt-2",style:{borderColor:"rgb(212 212 212)"},children:"Đơn hàng của bạn"}),e.jsx("div",{className:"flex flex-col justify-between",children:g.length>0?e.jsx(e.Fragment,{children:g.map((s,l)=>e.jsxs("div",{className:"flex justify-between w-full mb-2",children:[e.jsx(n.Text,{children:s.name}),e.jsx(n.Text,{type:"danger",strong:!0,children:k(s.price)})]},l))}):e.jsx(K,{description:"Chưa có khóa học nào trong giỏ hàng"})}),e.jsx(p,{style:{borderColor:"rgb(212 212 212)"},children:"Tổng cộng"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(n.Title,{className:"!my-0 !text-center",level:4,type:"danger",children:k(b)})}),g.length>0?e.jsxs(e.Fragment,{children:[e.jsx(p,{style:{borderColor:"rgb(212 212 212)"},children:"Phương thức thanh toán"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(n.Text,{type:"danger",children:"Chuyển khoản qua ngân hàng"})}),e.jsx(p,{style:{borderColor:"rgb(212 212 212)"}}),r!=null&&r.userType?e.jsx(e.Fragment,{children:e.jsx(F,{type:"primary",onClick:()=>c.submit(),className:"w-full",size:"large",children:"Thanh Toán"})}):e.jsx(e.Fragment,{children:e.jsx(F,{type:"primary",onClick:()=>u("/login",{state:{from:"/checkout"}}),className:"w-full",size:"large",children:"Đăng Nhập Để Thanh Toán"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{style:{borderColor:"rgb(212 212 212)"}}),e.jsx(F,{className:"w-full mb-4",size:"large",children:"Chưa có sản phẩm trong giỏ hàng"}),e.jsx(F,{type:"primary",onClick:()=>u("/courses"),className:"w-full",size:"large",children:"Thêm Sản Phẩm"})]})]})})]})}),e.jsxs(he,{title:"Xác nhận thanh toán",centered:!0,open:I,onOk:()=>Q(w),okText:"Thanh toán",onCancel:()=>v(!1),width:800,children:[e.jsxs(n,{className:"!mb-3",children:["Trước khi thanh toán vui lòng xác nhận lại"," ",e.jsx("span",{children:e.jsx(n.Link,{children:"đơn hàng "})})," ","và"," ",e.jsx("span",{children:e.jsx(n.Link,{children:"tài khoản nhận tiền"})})," ","của ",(A=y[0])==null?void 0:A.name,":"," "]}),e.jsx(p,{className:"!mt-2",style:{borderColor:"rgb(212 212 212)"},children:"Đơn hàng của bạn"}),e.jsx("div",{className:"flex flex-col justify-between",children:g.length>0?e.jsx(e.Fragment,{children:g.map((s,l)=>e.jsxs("div",{className:"flex justify-between w-full mb-2",children:[e.jsx(n.Text,{children:s.name}),e.jsx(n.Text,{type:"danger",strong:!0,children:k(s.price)})]},l))}):e.jsx(K,{description:"Chưa có khóa học nào trong giỏ hàng"})}),e.jsx(p,{style:{borderColor:"rgb(212 212 212)"},children:"Tổng cộng"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(n.Title,{className:"!my-0 !text-center",level:4,type:"danger",children:k(b)})}),e.jsx(p,{style:{borderColor:"rgb(212 212 212)"},children:"Phương thức thanh toán"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(n.Link,{className:"!my-0 !text-center",level:4,children:"Chuyển khoản ngân hàng"})}),e.jsxs(p,{style:{borderColor:"rgb(212 212 212)"},children:["Thông tin tài khoản nhận tiền của"," ",e.jsx("span",{children:e.jsx(n.Link,{children:(V=(M=y==null?void 0:y.newData)==null?void 0:M[0])==null?void 0:V.name})})]}),e.jsxs(n.Title,{className:"!my-3",level:5,children:["Tên Ngân Hàng:"," ",e.jsx("span",{children:e.jsx(n.Link,{children:h==null?void 0:h.name})})," "]}),e.jsxs(n.Title,{className:"!my-3",level:5,children:["Tên Tài Khoản:"," ",e.jsxs("span",{children:[e.jsxs(n.Link,{children:[h==null?void 0:h.nameAccount," "]})," "]})," "]}),e.jsxs(n.Title,{className:"!my-3",level:5,children:["Số Tài Khoản:"," ",e.jsx("span",{children:e.jsxs(n.Link,{children:[h==null?void 0:h.account," "]})})," "]}),e.jsxs(n.Title,{level:5,type:"danger",className:"!my-3 text-end",children:["Không biết thanh toán?",e.jsx("span",{className:"ms-2",children:e.jsx(te,{target:"_blank",to:"/huong-dan-thanh-toan",children:"Hướng dẫn"})})]})]})]})};export{ze as default};
