import{C as D,a as Q,c as J,d as I,r as o,g as Y,D as Z,j as e,N as ee,o as ne,E as N,k as se}from"./index-xq1IhvnX.js";import{L as re}from"./Layout-BjKrrWr3.js";import{u as ae}from"./Cart-Dl7X9Ndz.js";import{F as b}from"./Format-BcvZhZH2.js";import{p as v}from"./provinceVNApi-9WZOtzjw.js";import{F as c}from"./index-i_KdcLVM.js";import{R as E,C as g,T as s}from"./index-fL_rF7-I.js";import{C as z}from"./index-BHsLfoyo.js";import{I as u}from"./index-D5cKzEI1.js";import{S as C}from"./index-C0JrUhgO.js";import{D as m}from"./index-D-YQ6JWZ.js";import{E as L}from"./index-1JKPf1rL.js";import{B as f,M as te}from"./index-BCPS-Hci.js";import"./index-BeHqjPFW.js";import"./EllipsisOutlined-rXpF71Wb.js";import"./Overflow-DfJmp3ND.js";import"./useVariants-BIfgDl13.js";import"./CheckOutlined-ElLJZnRB.js";import"./index-CVErwFRe.js";import"./SearchOutlined-BGPSXXyr.js";const A="v1/payment",le=async()=>await D.post(`${A}/momo`),ie=async x=>await D.post(`${A}/bank`,x),q={MoMo:le,Bank:ie},Se=()=>{var F,S,P;const x=Q(),T=J(),[d]=c.useForm(),t=I(n=>{var r;return(r=n.auth)==null?void 0:r.user}),{info:j,loading:M}=I(n=>n.info),[h,V]=o.useState(""),[H,w]=o.useState(!1),{carts:p,total:y}=ae(),[_,k]=o.useState(),[K,O]=o.useState([]),[R,B]=o.useState([]),[U,W]=o.useState([]),X=n=>{w(!0),k(n)},$=async n=>{const r=p.map(l=>({id:l._id,name:l.name,price:l.price,quantity:1}));ne("","Đang xử lý thanh toán");const i=Number(String(Date.now()).slice(-3)+String(Math.floor(Math.random()*1e3)).slice(-3));n.product=r,n.idUser=t._id;try{const l=await N.check({id:t._id,product:r,data:n});if(l.urlPayment==""){const{url:a}=await q.Bank({id:i,product:r,total:y});N.putOrderId({orderId:l.orderId,urlPayment:a}).then(G=>{k(G),window.location.href=a})}else window.location.href=l.urlPayment}catch{const{url:a}=await q.Bank({id:i,product:r,total:y});n.urlPayment=a,n.orderId=i,N.add(n).then(()=>{window.location.href=a}).catch(()=>{se("","Thanh toán thất bại")})}};return o.useEffect(()=>{M&&T(Y())},[]),o.useEffect(()=>{Z.get().then(n=>{V(n[0])})},[]),o.useEffect(()=>{v.province().then(n=>{const r=n.map(i=>({label:i.name,value:i.name,key:i.code}));O(r)})},[]),o.useEffect(()=>{t!=null&&t._id&&d.setFieldsValue({name:t.name,phone:t.phone,email:t.email})},[t]),e.jsxs(re,{title:"Thanh toán",children:[e.jsx("section",{children:e.jsxs(E,{gutter:[24,24],children:[e.jsx(g,{span:24,xl:{span:17},lg:{span:15},md:{span:24,order:1},xs:{order:2},children:e.jsx(z,{children:e.jsxs(c,{scrollToFirstError:!0,form:d,name:"customForm",layout:"vertical",onFinish:X,children:[e.jsx(c.Item,{className:"mb-4",name:"name",label:"Họ và tên",rules:[{required:!0,message:"Nhập họ và tên!"}],children:e.jsx(u,{size:"large",placeholder:"Nhập họ và tên"})}),e.jsx(c.Item,{className:"mb-4",name:"phone",label:"Số điện thoại",validateFirst:!0,rules:[{required:!0,message:"Vui lòng nhập số điện thoại!"},{pattern:/^0/,message:"Số điện thoại phải bắt đầu bằng số 0!"},{len:10,message:"Số điện thoại phải có đúng 10 số!"}],children:e.jsx(u,{size:"large",placeholder:"Nhập số điện thoại"})}),e.jsx(c.Item,{className:"mb-4",name:"email",label:"Email",validateFirst:!0,rules:[{required:!0,message:"Vui lòng nhập email!"},{type:"email",message:"Email không đúng định dạng!"}],children:e.jsx(u,{size:"large",placeholder:"Nhập email"})}),e.jsxs(E,{gutter:[24,24],children:[e.jsx(g,{md:{span:8},span:24,children:e.jsx(c.Item,{className:"mb-2",name:"province",label:"Tỉnh/Thành phố",rules:[{required:!0,message:"Chọn tỉnh hoặc thành phố!"}],children:e.jsx(C,{showSearch:!0,optionFilterProp:"label",size:"large",className:"mb-2",placeholder:"Chọn tỉnh hoặc thành phố",options:K,onChange:(n,r)=>{v.district(r.key).then(i=>{const l=i.map(a=>({label:a.name,value:a.name,key:a.code}));B(l),d.setFieldsValue({district:void 0}),d.setFieldsValue({ward:void 0})})}})})}),e.jsx(g,{md:{span:8},span:24,children:e.jsx(c.Item,{className:"mb-2",name:"district",label:"Quận/Huyện",rules:[{required:!0,message:"Chọn quận hoặc huyện!"}],children:e.jsx(C,{showSearch:!0,optionFilterProp:"label",size:"large",className:"mb-2",placeholder:"Chọn quận hoặc huyện",options:R,onChange:(n,r)=>{v.ward(r.key).then(i=>{const l=i.map(a=>({label:a.name,value:a.name,key:a.code}));W(l),d.setFieldsValue({ward:void 0})})}})})}),e.jsx(g,{md:{span:8},span:24,children:e.jsx(c.Item,{className:"mb-2",name:"ward",label:"Xã/Phường",rules:[{required:!0,message:"Chọn xã hoặc phường!"}],children:e.jsx(C,{showSearch:!0,optionFilterProp:"label",size:"large",className:"mb-2",placeholder:"Chọn xã hoặc phường",options:U})})})]}),e.jsx(c.Item,{className:"mb-4",name:"address",label:"Địa chỉ",rules:[{required:!0,message:"Nhập địa chỉ!"}],children:e.jsx(u,{size:"large",placeholder:"Nhập địa chỉ"})}),e.jsx(c.Item,{className:"mb-0",name:"note",label:"Ghi chú",children:e.jsx(u.TextArea,{style:{height:120,minHeight:190},size:"large",placeholder:"Nhập ghi chú"})})]})})}),e.jsx(g,{className:"mx-auto",span:24,xl:{span:7},lg:{span:9},md:{span:14,order:2},xs:{order:1},children:e.jsxs(z,{className:"sticky top-24",children:[e.jsx(m,{className:"!mt-2",style:{borderColor:"rgb(212 212 212)"},children:"Đơn hàng của bạn"}),e.jsx("div",{className:"flex flex-col justify-between",children:p.length>0?e.jsx(e.Fragment,{children:p.map((n,r)=>e.jsxs("div",{className:"flex justify-between w-full mb-2",children:[e.jsx(s.Text,{children:n.name}),e.jsx(s.Text,{type:"danger",strong:!0,children:b(n.price)})]},r))}):e.jsx(L,{description:"Chưa có khóa học nào trong giỏ hàng"})}),e.jsx(m,{style:{borderColor:"rgb(212 212 212)"},children:"Tổng cộng"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(s.Title,{className:"!my-0 !text-center",level:4,type:"danger",children:b(y)})}),p.length>0?e.jsxs(e.Fragment,{children:[e.jsx(m,{style:{borderColor:"rgb(212 212 212)"},children:"Phương thức thanh toán"}),e.jsx(s,{children:"Chuyển khoản qua ngân hàng"}),e.jsx(m,{style:{borderColor:"rgb(212 212 212)"}}),t!=null&&t.userType?e.jsx(e.Fragment,{children:e.jsx(f,{type:"primary",onClick:()=>d.submit(),className:"w-full",size:"large",children:"Thanh Toán"})}):e.jsx(e.Fragment,{children:e.jsx(f,{type:"primary",onClick:()=>x("/login",{state:{from:"/checkout"}}),className:"w-full",size:"large",children:"Đăng Nhập Để Thanh Toán"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{style:{borderColor:"rgb(212 212 212)"}}),e.jsx(f,{className:"w-full mb-4",size:"large",children:"Chưa có sản phẩm trong giỏ hàng"}),e.jsx(f,{type:"primary",onClick:()=>x("/courses"),className:"w-full",size:"large",children:"Thêm Sản Phẩm"})]})]})})]})}),e.jsxs(te,{title:"Xác nhận thanh toán",centered:!0,open:H,onOk:()=>$(_),okText:"Thanh toán",onCancel:()=>w(!1),width:800,children:[e.jsxs(s,{className:"!mb-3",children:["Trước khi thanh toán vui lòng xác nhận lại ",e.jsx("span",{children:e.jsx(s.Link,{children:"đơn hàng "})})," và ",e.jsx("span",{children:e.jsx(s.Link,{children:"tài khoản nhận tiền"})})," của ",(F=j[0])==null?void 0:F.name,":  "]}),e.jsx(m,{className:"!mt-2",style:{borderColor:"rgb(212 212 212)"},children:"Đơn hàng của bạn"}),e.jsx("div",{className:"flex flex-col justify-between",children:p.length>0?e.jsx(e.Fragment,{children:p.map((n,r)=>e.jsxs("div",{className:"flex justify-between w-full mb-2",children:[e.jsx(s.Text,{children:n.name}),e.jsx(s.Text,{type:"danger",strong:!0,children:b(n.price)})]},r))}):e.jsx(L,{description:"Chưa có khóa học nào trong giỏ hàng"})}),e.jsx(m,{style:{borderColor:"rgb(212 212 212)"},children:"Tổng cộng"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(s.Title,{className:"!my-0 !text-center",level:4,type:"danger",children:b(y)})}),e.jsx(m,{style:{borderColor:"rgb(212 212 212)"},children:"Phương thức thanh toán"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(s.Link,{className:"!my-0 !text-center",level:4,children:"Chuyển khoản ngân hàng"})}),e.jsxs(m,{style:{borderColor:"rgb(212 212 212)"},children:["Thông tin tài khoản nhận tiền của  ",e.jsx("span",{children:e.jsx(s.Link,{children:(P=(S=j==null?void 0:j.newData)==null?void 0:S[0])==null?void 0:P.name})})]}),e.jsxs(s.Title,{className:"!my-3",level:5,children:["Tên Ngân Hàng:  ",e.jsx("span",{children:e.jsx(s.Link,{children:h==null?void 0:h.name})})," "]}),e.jsxs(s.Title,{className:"!my-3",level:5,children:["Tên Tài Khoản: ",e.jsxs("span",{children:[e.jsxs(s.Link,{children:[h==null?void 0:h.nameAccount," "]})," "]})," "]}),e.jsxs(s.Title,{className:"!my-3",level:5,children:["Số Tài Khoản: ",e.jsx("span",{children:e.jsxs(s.Link,{children:[h==null?void 0:h.account," "]})})," "]}),e.jsxs(s.Title,{level:5,type:"danger",className:"!my-3 text-end",children:["Không biết thanh toán?",e.jsx("span",{className:"ms-2",children:e.jsx(ee,{target:"_blank",to:"/huong-dan-thanh-toan",children:"Hướng dẫn"})})]})]})]})};export{Se as default};
